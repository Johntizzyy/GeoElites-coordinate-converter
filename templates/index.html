<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoElites Converter</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

    <style>
        /* GLOBAL RESET */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f1f8e9; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }

        /* HEADER */
        header { background: linear-gradient(90deg, #66bb6a, #43a047); color: white; text-align: center; padding: 15px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        header h1 { margin: 0; font-size: 1.5rem; }

        /* LAYOUT */
        .main-container { display: flex; flex: 1; padding: 20px; gap: 20px; overflow: hidden; position: relative; }

        /* LEFT PANEL */
        .converter-panel { width: 450px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; z-index: 20; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 4px solid #66bb6a; }
        .card h3 { margin-top: 0; font-size: 1.1rem; color: #2e7d32; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 15px; }

        /* INPUTS & BUTTONS */
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-group { flex: 1; }
        label { display: block; font-size: 0.8rem; color: #555; margin-bottom: 4px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; background-color: #66bb6a; color: white; border: none; padding: 12px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 5px; }
        button:hover { background-color: #43a047; }
        .locate-btn { background-color: #ff9800; width: auto; font-size: 0.8rem; padding: 5px 15px; margin-bottom: 15px; }

        /* RESULTS */
        .result-box { margin-top: 10px; padding: 10px; background-color: #e8f5e9; border-left: 4px solid #66bb6a; font-size: 0.9rem; display: none; }

        /* RIGHT PANEL (MAP) - FORCED HEIGHT FIX */
        .map-panel { flex: 1; background: #e0e0e0; border-radius: 12px; overflow: hidden; position: relative; min-height: 400px; z-index: 10; }
        #map { width: 100%; height: 100%; z-index: 1; }

        /* FOOTER */
        footer { background-color: #1b5e20; color: white; text-align: center; padding: 10px; font-size: 0.8rem; }

        /* MOBILE */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; height: auto; overflow: auto; }
            .converter-panel { width: 100%; }
            .map-panel { height: 400px; flex: none; }
        }
    </style>
</head>
<body>

    <header><h1>GeoElites Coordinate Converter</h1></header>

    <div class="main-container">
        <div class="converter-panel">

            <div class="card">
                <h3>WGS84 &rarr; Minna / UTM</h3>
                <button onclick="locateMe()" class="locate-btn">üìç Use My GPS Location</button>
                <div class="input-row">
                    <div class="input-group">
                        <label>Latitude (Dec or DMS)</label>
                        <input type="text" id="wgs_lat" placeholder="e.g. 8 30 15 or 8.5">
                    </div>
                    <div class="input-group">
                        <label>Longitude (Dec or DMS)</label>
                        <input type="text" id="wgs_lon" placeholder="e.g. 4 30 15 or 4.5">
                    </div>
                </div>
                <div class="input-row">
                    <button onclick="convert('wgs_to_minna')">To Minna</button>
                    <button onclick="convert('wgs_to_utm')" style="margin-left: 5px;">To UTM</button>
                </div>
                <div id="res_wgs" class="result-box"></div>
            </div>

            <div class="card">
                <h3>Minna (Geographic) &rarr; WGS84 / UTM</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Latitude (Minna)</label>
                        <input type="text" id="minna_lat" placeholder="e.g. 8 30 15">
                    </div>
                    <div class="input-group">
                        <label>Longitude (Minna)</label>
                        <input type="text" id="minna_lon" placeholder="e.g. 4 30 15">
                    </div>
                </div>
                <div class="input-row">
                    <button onclick="convert('minna_to_wgs')">To WGS84</button>
                    <button onclick="convert('minna_to_utm')" style="margin-left: 5px;">To Minna UTM</button>
                </div>
                <div id="res_minna" class="result-box"></div>
            </div>

            <div class="card">
                <h3>Minna (UTM) &rarr; WGS84</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Easting (m)</label>
                        <input type="text" id="utm_e" placeholder="e.g. 500000">
                    </div>
                    <div class="input-group">
                        <label>Northing (m)</label>
                        <input type="text" id="utm_n" placeholder="e.g. 900000">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Zone (Required)</label>
                        <select id="utm_z">
                            <option value="" selected disabled>-- Select Zone --</option>
                            <option value="31">Zone 31 </option>
                            <option value="32">Zone 32 </option>
                            <option value="33">Zone 33 </option>
                        </select>
                    </div>
                </div>
                <button onclick="convert('utm_to_wgs')">Convert to WGS84</button>
                <div id="res_utm" class="result-box"></div>
            </div>
        </div>

        <div class="map-panel">
            <div id="map"></div>
        </div>
    </div>

    <footer>&copy; Department of Surveying and Geoinformatics, University of Ilorin</footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // --- INITIALIZE MAP ---
        var map = L.map('map', { zoomControl: false, center: [8.482, 4.675], zoom: 13 });
        var marker;
        var accuracyCircle;

        // --- BASEMAPS ---
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '¬© OpenStreetMap' }).addTo(map);
        var sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { maxZoom: 19, attribution: 'Tiles ¬© Esri' });
        L.control.layers({ "Street Map": osm, "Satellite": sat }).addTo(map);

        // --- CONTROLS ---
        L.control.zoom({ position: 'topright' }).addTo(map);
        L.control.scale({ position: 'bottomright', metric: true, imperial: false }).addTo(map);

        // --- HELPER FUNCTIONS ---
        function showResult(id, html) {
            var el = document.getElementById(id);
            el.innerHTML = html;
            el.style.display = 'block';
        }

        function updateMap(lat, lon, popupText) {
            lat = parseFloat(lat); lon = parseFloat(lon);
            if (isNaN(lat) || isNaN(lon)) return;
            if (marker) map.removeLayer(marker);
            marker = L.marker([lat, lon]).addTo(map).bindPopup(popupText).openPopup();
            map.flyTo([lat, lon], 17, { animate: true, duration: 1.5 });
        }

        // --- GPS LOGIC ---
        function locateMe() {
            if (!navigator.geolocation) return alert("Geolocation not supported.");
            navigator.geolocation.getCurrentPosition((pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                const acc = pos.coords.accuracy;

                document.getElementById('wgs_lat').value = lat.toFixed(7);
                document.getElementById('wgs_lon').value = lon.toFixed(7);

                updateMap(lat, lon, `<b>Your GPS Location</b><br>Accuracy: ¬±${Math.round(acc)}m`);

                if (accuracyCircle) map.removeLayer(accuracyCircle);
                accuracyCircle = L.circle([lat, lon], { color: '#136AEC', fillColor: '#136AEC', fillOpacity: 0.15, radius: acc }).addTo(map);
                map.fitBounds(accuracyCircle.getBounds());
            }, (err) => { alert("GPS Error: " + err.message); }, { enableHighAccuracy: true });
        }

        // --- CONVERSION LOGIC ---
        function convert(type) {
            var data = { type: type };

            // Gather Inputs
            if (type.includes('wgs')) {
                data.lat = document.getElementById('wgs_lat').value;
                data.lon = document.getElementById('wgs_lon').value;
            } else if (type.includes('minna')) {
                data.lat = document.getElementById('minna_lat').value;
                data.lon = document.getElementById('minna_lon').value;
            } else if (type.includes('utm')) {
                data.easting = document.getElementById('utm_e').value;
                data.northing = document.getElementById('utm_n').value;
                data.zone = document.getElementById('utm_z').value;
                if (!data.zone) return alert("‚ö†Ô∏è Please select a UTM Zone!");
            }

            // Send to Backend
            fetch('/convert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(res => {
                if (!res.success) return alert("Error: " + res.error);

                if (type === 'wgs_to_minna') {
                    showResult('res_wgs', `<b>Minna Datum:</b><br>Lat: ${res.lat_dms}<br>Lon: ${res.lon_dms}`);
                    updateMap(data.lat, data.lon, "Input WGS84");
                } else if (type === 'wgs_to_utm') {
                    showResult('res_wgs', `<b>Zone ${res.zone}:</b><br>E: ${res.easting}m<br>N: ${res.northing}m`);
                    updateMap(data.lat, data.lon, "Input WGS84");
                } else if (type === 'minna_to_wgs') {
                    showResult('res_minna', `<b>WGS84 Result:</b><br>Lat: ${res.lat_dms}<br>Lon: ${res.lon_dms}`);
                    updateMap(res.lat, res.lon, "Converted WGS84");
                } else if (type === 'minna_to_utm') {
                    showResult('res_minna', `<b>Minna UTM:</b><br>Zone ${res.zone}<br>E: ${res.easting}<br>N: ${res.northing}`);
                    updateMap(res.map_lat, res.map_lon, "Converted Location");
                } else if (type === 'utm_to_wgs') {
                    showResult('res_utm', `<b>WGS84 Result:</b><br>Lat: ${res.lat_dms}<br>Lon: ${res.lon_dms}`);
                    updateMap(res.lat, res.lon, "Converted WGS84");
                }
            })
            .catch(err => console.error(err));
        }
    </script>
</body>
</html>